<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>papiuxxxxx</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Animaciones */
        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes ping-slow {

            75%,
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        @keyframes shimmer {
            0% {
                border-color: rgba(234, 179, 8, 0.5);
                box-shadow: 0 0 20px rgba(234, 179, 8, 0.2);
            }

            50% {
                border-color: rgba(255, 255, 255, 0.8);
                box-shadow: 0 0 50px rgba(234, 179, 8, 0.6);
            }

            100% {
                border-color: rgba(234, 179, 8, 0.5);
                box-shadow: 0 0 20px rgba(234, 179, 8, 0.2);
            }
        }

        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }

        .animate-ping-slow {
            animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        .animate-shimmer {
            animation: shimmer 4s infinite;
        }

        .animate-bounce-custom {
            animation: bounce 1s infinite;
        }

        /* Utilidades extra */
        .hidden-option {
            visibility: hidden;
            pointer-events: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body
    class="bg-slate-950 text-white font-sans min-h-screen flex flex-col items-center justify-center overflow-x-hidden selection:bg-yellow-500 selection:text-black">


    <div id="app" class="w-full max-w-4xl p-4 flex flex-col items-center justify-center relative">

    </div>

    <!-- Notificaciones de Logros (Toast) -->
    <div id="achievement-toast-container" class="fixed bottom-4 right-4 flex flex-col gap-2 pointer-events-none z-50">
    </div>

    <script>
        // --- BASE DE DATOS DE PREGUNTAS ---
        const questionsData = [
            // NIVEL 1
            { id: 1, q: "Â¿QuiÃ©n escribiÃ³ 'La Riqueza de las Naciones'?", options: ["Karl Marx", "Adam Smith", "David Ricardo", "John Locke"], correct: 1, category: "EconomÃ­a", difficulty: 1, keywords: ["adam smith", "smith"], explanation: "Adam Smith fue un economista y filÃ³sofo escocÃ©s, considerado el padre de la economÃ­a moderna. Su obra de 1776 postula la 'mano invisible' del mercado." },
            { id: 2, q: "Â¿CuÃ¡l es el libro sagrado del Zoroastrismo?", options: ["El CorÃ¡n", "La TorÃ¡", "El Avesta", "Los Vedas"], correct: 2, category: "ReligiÃ³n", difficulty: 1, keywords: ["avesta", "el avesta"], explanation: "El Avesta es la colecciÃ³n de textos sagrados de la fe zoroÃ¡strica, que sigue las enseÃ±anzas del profeta Zaratustra." },
            { id: 3, q: "Â¿QuiÃ©n es la musa de la poesÃ­a Ã©pica en la mitologÃ­a griega?", options: ["ClÃ­o", "CalÃ­ope", "Erato", "Euterpe"], correct: 1, category: "MitologÃ­a", difficulty: 1, keywords: ["caliope", "calÃ­ope"], explanation: "CalÃ­ope (cuyo nombre significa 'la de la bella voz') es la musa de la poesÃ­a Ã©pica y la elocuencia, generalmente representada con una tablilla y un estilete." },
            { id: 4, q: "Â¿QuÃ© guerra es el escenario de la 'IlÃ­ada' de Homero?", options: ["Guerra del Peloponeso", "Guerras MÃ©dicas", "Guerra de Troya", "Batalla de las TermÃ³pilas"], correct: 2, category: "Literatura", difficulty: 1, keywords: ["troya", "guerra de troya"], explanation: "La IlÃ­ada narra los eventos del Ãºltimo aÃ±o de la Guerra de Troya, conflicto entre aqueos y troyanos legendariamente causado por el rapto de Helena." },

            // NIVEL 2
            { id: 6, q: "Â¿En 'La Divina Comedia', quiÃ©n guÃ­a a Dante a travÃ©s del ParaÃ­so?", options: ["Virgilio", "Beatriz", "San Bernardo", "Caronte"], correct: 1, category: "Literatura", difficulty: 2, keywords: ["beatriz", "beatrice"], explanation: "Beatriz (Beatrice Portinari) guÃ­a a Dante por el ParaÃ­so. Virgilio solo puede guiarlo a travÃ©s del Infierno y el Purgatorio, pues Ã©l no fue bautizado." },
            { id: 7, q: "Â¿QuÃ© concilio ecumÃ©nico condenÃ³ el arrianismo en el aÃ±o 325?", options: ["Concilio de Trento", "Concilio de Ã‰feso", "Concilio de Nicea", "Concilio Vaticano I"], correct: 2, category: "TeologÃ­a", difficulty: 2, keywords: ["nicea", "concilio de nicea"], explanation: "El Primer Concilio de Nicea (325 d.C.) fue convocado por el emperador Constantino I y condenÃ³ formalmente la doctrina del Arrianismo, que negaba la plena divinidad de JesÃºs." },
            { id: 8, q: "Â¿QuiÃ©n fue el maestro de Alejandro Magno?", options: ["SÃ³crates", "PlatÃ³n", "AristÃ³teles", "DiÃ³genes"], correct: 2, category: "Historia", difficulty: 2, keywords: ["aristoteles", "aristÃ³teles"], explanation: "AristÃ³teles fue el tutor personal de Alejandro Magno desde el 343 a.C. hasta que Alejandro se convirtiÃ³ en rey de Macedonia." },
            { id: 9, q: "Â¿QuÃ© filÃ³sofo alemÃ¡n escribiÃ³ 'FenomenologÃ­a del espÃ­ritu'?", options: ["Kant", "Hegel", "Schopenhauer", "Nietzsche"], correct: 1, category: "FilosofÃ­a", difficulty: 2, keywords: ["hegel"], explanation: "Georg Wilhelm Friedrich Hegel, uno de los pensadores mÃ¡s importantes del idealismo alemÃ¡n, publicÃ³ esta obra en 1807. Es un complejo recorrido por la conciencia humana." },

            // NIVEL 3
            { id: 11, q: "Â¿QuÃ© matemÃ¡tico demostrÃ³ el Teorema de la Incompletitud?", options: ["Alan Turing", "Kurt GÃ¶del", "David Hilbert", "John von Neumann"], correct: 1, category: "MatemÃ¡ticas", difficulty: 3, keywords: ["godel", "gÃ¶del", "kurt gÃ¶del"], explanation: "Kurt GÃ¶del (1931) demostrÃ³ que en cualquier sistema formal lo suficientemente potente para expresar la aritmÃ©tica, existirÃ¡n siempre proposiciones que son verdaderas pero indemostrables dentro del sistema." },
            { id: 12, q: "Â¿CÃ³mo se llama la primera novela considerada de la historia (JapÃ³n)?", options: ["El libro de la almohada", "Genji Monogatari", "Heike Monogatari", "Kojiki"], correct: 1, category: "Literatura", difficulty: 3, keywords: ["genji", "genji monogatari", "romance de genji"], explanation: "El Genji Monogatari (La Historia de Genji), escrito por Murasaki Shikibu a principios del siglo XI, es a menudo citado como la primera novela psicolÃ³gica de la historia mundial." },
            { id: 13, q: "Â¿QuÃ© batalla marcÃ³ el final definitivo de NapoleÃ³n?", options: ["Austerlitz", "Leipzig", "Waterloo", "Trafalgar"], correct: 2, category: "Historia", difficulty: 3, keywords: ["waterloo"], explanation: "La Batalla de Waterloo (1815) fue la derrota final de NapoleÃ³n Bonaparte, lo que condujo a su exilio permanente." },
            { id: 15, q: "Â¿QuiÃ©n comandaba las fuerzas prusianas en Waterloo?", options: ["Von Moltke", "Gebhard von BlÃ¼cher", "Federico el Grande", "Bismarck"], correct: 1, category: "Historia", difficulty: 3, keywords: ["blucher", "blÃ¼cher", "gebhard von blÃ¼cher"], explanation: "El mariscal de campo Gebhard Leberecht von BlÃ¼cher, Duque de Wahlstatt, comandÃ³ al ejÃ©rcito prusiano, cuya llegada tardÃ­a fue clave para la derrota francesa." },

            // NIVEL 4
            { id: 16, q: "Â¿CuÃ¡l es el postulado principal de la HipÃ³tesis de Riemann?", options: ["Espacio-tiempo", "NÃºmeros primos", "Dividir por cero", "EntropÃ­a"], correct: 1, category: "MatemÃ¡ticas", difficulty: 4, keywords: ["numeros primos", "nÃºmeros primos", "primos", "distribucion de los numeros primos"], explanation: "La HipÃ³tesis de Riemann es una conjetura sobre la distribuciÃ³n de los ceros de la funciÃ³n zeta de Riemann, y tiene profundas implicaciones sobre la distribuciÃ³n de los nÃºmeros primos." },
            { id: 17, q: "SegÃºn la Biblia, Â¿quiÃ©n fue el padre de MatusalÃ©n?", options: ["NoÃ©", "Enoc", "Lamec", "Jared"], correct: 1, category: "ReligiÃ³n", difficulty: 4, keywords: ["enoc", "henoc"], explanation: "GÃ©nesis 5:21 indica que Enoc fue padre de MatusalÃ©n a la edad de 65 aÃ±os." },
            { id: 19, q: "Â¿En 'Los Hermanos KaramÃ¡zov', quiÃ©n dice el poema 'El Gran Inquisidor'?", options: ["Dmitri", "Alioscha", "IvÃ¡n", "Smerdiakov"], correct: 2, category: "Literatura", difficulty: 4, keywords: ["ivan", "ivÃ¡n"], explanation: "IvÃ¡n Karamazov, el intelectual de la familia, le relata el poema a su hermano Alioscha. Es un famoso pasaje sobre la libertad, la fe y la moralidad." },

            // NIVEL 5
            { id: 21, q: "Â¿CuÃ¡l es la Ãºltima palabra de las tres partes de la Divina Comedia?", options: ["Amor", "Dios", "Estrellas", "Luz"], correct: 2, category: "Literatura", difficulty: 5, keywords: ["estrellas", "stelle"], explanation: "Cada una de las tres cÃ¡nticas (Infierno, Purgatorio y ParaÃ­so) termina con la palabra italiana 'stelle' (estrellas)." },
            { id: 22, q: "Â¿QuiÃ©n fue el primer Virrey de la Nueva EspaÃ±a?", options: ["HernÃ¡n CortÃ©s", "Antonio de Mendoza", "Juan de ZumÃ¡rraga", "Luis de Velasco"], correct: 1, category: "Historia", difficulty: 5, keywords: ["antonio de mendoza", "mendoza"], explanation: "Antonio de Mendoza y Pacheco asumiÃ³ el cargo en 1535. HernÃ¡n CortÃ©s fue el CapitÃ¡n General, pero no ostentÃ³ el tÃ­tulo de Virrey." },
            { id: 23, q: "Â¿CuÃ¡l es el elemento natural mÃ¡s raro en la corteza terrestre?", options: ["Osmio", "Francio", "Astato", "Iridio"], correct: 2, category: "Ciencia", difficulty: 5, keywords: ["astato"], explanation: "El Astato (At) se forma Ãºnicamente como producto de la desintegraciÃ³n radiactiva. Se estima que en cualquier momento solo existen unos 25 gramos de Astato en la corteza terrestre." },
            { id: 24, q: "Â¿En quÃ© aÃ±o exacto cayÃ³ Constantinopla?", options: ["1453", "1492", "1204", "1571"], correct: 0, category: "Historia", difficulty: 5, keywords: ["1453"], explanation: "Constantinopla cayÃ³ en manos del Imperio Otomano el 29 de mayo de 1453, marcando el fin del Imperio Bizantino y la Edad Media." },
            { id: 25, q: "En la Biblia, Â¿cÃ³mo se llamaba la esposa de MoisÃ©s?", options: ["SÃ©fora", "Miriam", "Rebeca", "Raquel"], correct: 0, category: "ReligiÃ³n", difficulty: 5, keywords: ["sefora", "sÃ©fora", "zipora"], explanation: "Ã‰xodo 2:21 menciona a SÃ©fora (TziporÃ¡) como la esposa de MoisÃ©s, hija de JetrÃ³." },
            { id: 26, q: "Â¿QuÃ© tratado comienza con 'El mundo es mi representaciÃ³n'?", options: ["El mundo como voluntad y representaciÃ³n", "AsÃ­ hablÃ³ Zaratustra", "CrÃ­tica de la razÃ³n pura", "LeviatÃ¡n"], correct: 0, category: "FilosofÃ­a", difficulty: 5, keywords: ["el mundo como voluntad y representacion", "el mundo como voluntad y representaciÃ³n", "mundo como voluntad"], explanation: "Es el comienzo de la principal obra de Arthur Schopenhauer (1818), quien desarrollÃ³ una filosofÃ­a pesimista basada en el concepto de la Voluntad como fuerza metafÃ­sica subyacente." },
            { id: 27, q: "Â¿QuÃ© intervalo es conocido como 'Diabolus in musica'?", options: ["SÃ©ptima mayor", "Tritono", "Segunda menor", "Octava"], correct: 1, category: "MÃºsica", difficulty: 5, keywords: ["tritono", "cuarta aumentada", "quinta disminuida"], explanation: "El tritono (intervalo de tres tonos enteros, como de Fa a Si) fue considerado discordante y perturbador, a menudo asociado con el diablo durante la Edad Media." },
            { id: 28, q: "Â¿CuÃ¡l es el nombre del primer autÃ³mata creado por Leonardo da Vinci?", options: ["El LeÃ³n", "El Caballero", "El Soldado", "El Hombre de Vitruvio"], correct: 1, category: "Arte", difficulty: 5, keywords: ["el caballero", "caballero"], explanation: "Leonardo da Vinci diseÃ±Ã³ un autÃ³mata con forma de caballero alrededor de 1495, capaz de sentarse, agitar los brazos y mover la mandÃ­bula." },

            // NIVEL 7 (Para Modo Infinito)
            { id: 30, q: "Â¿QuÃ© ley de la fÃ­sica prohÃ­be el movimiento continuo de un motor de segunda especie?", options: ["Primera Ley de Newton", "Ley de ConservaciÃ³n de la EnergÃ­a", "Segunda Ley de la TermodinÃ¡mica", "Ley de Boyle"], correct: 2, category: "FÃ­sica", difficulty: 7, keywords: ["segunda ley de la termodinamica", "entropia"], explanation: "La Segunda Ley de la TermodinÃ¡mica, que postula que la entropÃ­a de un sistema aislado siempre aumenta, prohÃ­be la creaciÃ³n de una mÃ¡quina que convierta calor completamente en trabajo (motor de segunda especie)." },
            { id: 31, q: "Â¿QuÃ© filÃ³sofo introdujo el concepto de 'Ã‰lan Vital' (Impulso Vital)?", options: ["Sartre", "Bergson", "Foucault", "Deleuze"], correct: 1, category: "FilosofÃ­a", difficulty: 7, keywords: ["bergson", "henri bergson"], explanation: "Henri Bergson, en su obra 'La EvoluciÃ³n Creadora' (1907), propuso el concepto de 'Ã‰lan Vital' para describir una fuerza hipotÃ©tica por la cual la vida se desarrolla y se auto-supera." },
            { id: 32, q: "Â¿CuÃ¡l es el nombre de la forma poÃ©tica japonesa de 5, 7, 5, 7, 7 sÃ­labas?", options: ["Haiku", "Tanka", "Renga", "Waka"], correct: 1, category: "Literatura", difficulty: 7, keywords: ["tanka", "waka"], explanation: "El Tanka es una forma mÃ¡s larga que el Haiku, siendo tradicionalmente la base del Waka (poesÃ­a japonesa). Tienen una estructura de 5-7-5-7-7 sÃ­labas, totalizando 31 sÃ­labas." },
            { id: 33, q: "Â¿QuÃ© documento histÃ³rico es conocido como 'la ConstituciÃ³n silenciada' de la RepÃºblica Romana?", options: ["Las Doce Tablas", "La Lex Hortensia", "El Corpus Juris Civilis", "La Ley Agraria de Tiberio Graco"], correct: 0, category: "Historia", difficulty: 7, keywords: ["las doce tablas"], explanation: "Aunque 'Las Doce Tablas' son fundamentales, el tÃ©rmino 'ConstituciÃ³n Silenciada' a menudo se refiere a la acumulaciÃ³n de costumbres (mos maiorum) y la autoridad del Senado, mÃ¡s que a un Ãºnico documento. La respuesta comÃºn en este nivel de dificultad es el de las 12 tablas." },

            // NIVEL 9 (Para Modo Infinito)
            { id: 40, q: "Â¿CuÃ¡l es el valor exacto de la Constante de ApÃ©ry, en su notaciÃ³n Zeta de Riemann?", options: ["Zeta(3)", "Gamma(2)", "Pi al cuadrado/6", "Euler-Mascheroni"], correct: 0, category: "MatemÃ¡ticas", difficulty: 9, keywords: ["zeta 3", "zeta(3)"], explanation: "La Constante de ApÃ©ry es el valor de la funciÃ³n zeta de Riemann cuando el argumento es 3, Î¶(3). Este es uno de los pocos valores irracionales conocidos para argumentos impares." },
            { id: 41, q: "Â¿QuÃ© tratado de 1713 puso fin a la Guerra de SucesiÃ³n EspaÃ±ola?", options: ["Tratado de Westfalia", "Tratado de Utrecht", "Paz de Augsburgo", "Tratado de ParÃ­s"], correct: 1, category: "Historia", difficulty: 9, keywords: ["utrecht", "tratado de utrecht"], explanation: "El Tratado de Utrecht fue una serie de acuerdos que pusieron fin a la Guerra de SucesiÃ³n EspaÃ±ola (1701-1714), reorganizando el mapa de poder en Europa y el mundo." },
            { id: 42, q: "Â¿QuÃ© nombre recibe el 'Yo' que contempla Kant en su 'CrÃ­tica de la RazÃ³n Pura'?", options: ["NoÃºmeno", "Ding an sich", "Yo Trascendental", "Voluntad"], correct: 2, category: "FilosofÃ­a", difficulty: 9, keywords: ["yo trascendental", "trascendental"], explanation: "El 'Yo Trascendental' o 'ApercepciÃ³n Trascendental' es la condiciÃ³n de posibilidad de la experiencia que unifica la conciencia, distinto del yo empÃ­rico." },

            // NIVEL 10 (PrÃ¡cticamente Imposible)
            { id: 43, q: "Â¿En quÃ© aÃ±o y por quiÃ©n fue descubierto el primer satÃ©lite de Saturno (TitÃ¡n)?", options: ["1655, Christiaan Huygens", "1610, Galileo Galilei", "1789, William Herschel", "1846, Urbain Le Verrier"], correct: 0, category: "Ciencia", difficulty: 10, keywords: ["1655 christiaan huygens", "huygens"], explanation: "TitÃ¡n, el satÃ©lite mÃ¡s grande de Saturno y el segundo mÃ¡s grande del sistema solar, fue descubierto el 25 de marzo de 1655 por el astrÃ³nomo neerlandÃ©s Christiaan Huygens." },
            { id: 44, q: "Â¿QuiÃ©n fue el Ãºltimo monarca inca que resistiÃ³ en Vilcabamba antes de ser capturado?", options: ["PachacÃºtec", "Manco Inca", "TÃºpac Amaru I", "Atahualpa"], correct: 2, category: "Historia", difficulty: 10, keywords: ["tupac amaru i", "tÃºpac amaru i"], explanation: "TÃºpac Amaru I fue el Ãºltimo lÃ­der del estado neo-inca de Vilcabamba, capturado y ejecutado por los espaÃ±oles en 1572, marcando el fin de la resistencia incaica." },
            { id: 45, q: "Â¿QuÃ© texto antiguo hindÃº (Veda) contiene principalmente himnos rituales?", options: ["Rigveda", "Yajurveda", "Samaveda", "Atharvaveda"], correct: 1, category: "ReligiÃ³n", difficulty: 10, keywords: ["yajurveda"], explanation: "El Yajurveda es el Veda de las fÃ³rmulas de sacrificio. Contiene himnos, oraciones y mantras utilizados por los sacerdotes para realizar los rituales del sacrificio (YajÃ±a)." },

            // NIVEL 11
            { id: 50, q: "Â¿CuÃ¡l es el nombre del cuarto y Ãºltimo evangelio apÃ³crifo de Nag Hammadi?", options: ["Evangelio de TomÃ¡s", "Evangelio de Felipe", "Evangelio de MarÃ­a Magdalena", "Evangelio de la Verdad"], correct: 3, category: "TeologÃ­a", difficulty: 11, keywords: ["evangelio de la verdad", "veritas"], explanation: "El Evangelio de la Verdad es uno de los 52 textos encontrados en la biblioteca de Nag Hammadi en 1945, perteneciente a la escuela gnÃ³stica." },
            { id: 51, q: "Â¿A quÃ© escuela de pensamiento se adhiriÃ³ Albert Camus en su fase inicial?", options: ["Existencialismo", "Nihilismo", "Absurdismo", "Humanismo"], correct: 2, category: "FilosofÃ­a", difficulty: 11, keywords: ["absurdismo"], explanation: "Albert Camus es el principal exponente del Absurdismo, que postula la falta de sentido de la vida ante la indiferencia del universo." },
            { id: 52, q: "Â¿QuÃ© compositor romÃ¡ntico escribiÃ³ la sinfonÃ­a 'La fantÃ¡stica'?", options: ["Beethoven", "Brahms", "Berlioz", "Chopin"], correct: 2, category: "MÃºsica", difficulty: 11, keywords: ["berlioz", "hector berlioz"], explanation: "Hector Berlioz compuso la 'SinfonÃ­a fantÃ¡stica' (Symphonie fantastique) en 1830, una obra programÃ¡tica que narra la historia de un artista obsesionado." },

            // NIVEL 12
            { id: 53, q: "Â¿QuiÃ©n demostrÃ³ que el conjunto de los nÃºmeros naturales y los enteros tiene la misma cardinalidad?", options: ["Georg Cantor", "Bertrand Russell", "David Hilbert", "Leopold Kronecker"], correct: 0, category: "MatemÃ¡ticas", difficulty: 12, keywords: ["cantor", "georg cantor"], explanation: "Georg Cantor demostrÃ³ la equipotencia entre los nÃºmeros naturales (N) y los enteros (Z) y los racionales (Q), mostrando que son contables (Aleph-cero), pero que los reales (R) no lo son." },
            { id: 54, q: "Â¿En quÃ© aÃ±o se firmÃ³ el Tratado de Tordesillas?", options: ["1492", "1494", "1500", "1502"], correct: 1, category: "Historia", difficulty: 12, keywords: ["1494"], explanation: "El Tratado de Tordesillas fue firmado el 7 de junio de 1494 entre los Reyes CatÃ³licos de Castilla y AragÃ³n y el rey Juan II de Portugal, para repartir las zonas de navegaciÃ³n y conquista del OcÃ©ano AtlÃ¡ntico y el Nuevo Mundo." },
            { id: 55, q: "Â¿CuÃ¡l es el principal compuesto quÃ­mico responsable de la bioluminiscencia en las luciÃ©rnagas?", options: ["Clorofila", "FosfÃ³geno", "Luciferina", "Adenosina"], correct: 2, category: "Ciencia", difficulty: 12, keywords: ["luciferina"], explanation: "La Luciferina es el sustrato quÃ­mico que, al reaccionar con el oxÃ­geno y la enzima Luciferasa, emite luz. El proceso se llama bioluminiscencia." },
        ];

        const allAchievementsData = [
            { id: 'first_blood', title: 'Primeros Pasos', description: 'Responde la primera pregunta correctamente.', isSecret: false },
            { id: 'streak_3', title: 'En Racha (3)', description: 'Consigue una racha de 3 respuestas correctas.', isSecret: false },
            { id: 'streak_5', title: 'Imparable (5)', description: 'Consigue una racha de 5 respuestas correctas.', isSecret: false },
            { id: 'extreme', title: 'Valiente', description: 'Gana una ronda en Modo Extremo.', isSecret: false },
            { id: 'grand_master', title: 'Maestro Completado', description: 'Completa todas las preguntas del juego base.', isSecret: false },
            { id: 'secret_infinite', title: '?? ?? ? (El Saber Oculto)', description: 'Responde 5 preguntas en el Modo Infinito.', isSecret: true },
        ];

        // --- ESTADO DEL JUEGO (GLOBAL STATE) ---
        const state = {
            gameState: 'start', // 'start', 'playing', 'end'
            currentQIndex: 0,
            score: 0,
            lives: 3,
            isAnswered: false,
            lifelines: { fifty: true, skip: true },
            hiddenOptions: [],
            gameQuestions: [],
            selectedCategory: 'all',
            isExtremeMode: false,
            isInfiniteMode: false,
            isInfiniteModeUnlocked: false,
            achievements: [],
            hasWicho: false,
            streak: 0,
            feedbackMsg: "",
            infiniteQuestionsAnswered: 0,
            isDiscoBallVisible: false,
            cheatBuffer: "",
            isAdmin: false,
            inputValue: ""
        };

        // --- FUNCIONES DE AYUDA ---
        const normalizeText = (text) => {
            return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
        };

        function shuffleArray(array) {
            let arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function loadProgression() {
            state.achievements = allAchievementsData.filter(a => localStorage.getItem(`ach_${a.id}`) === 'true');
            state.isInfiniteModeUnlocked = localStorage.getItem('infinite_unlocked') === 'true';
            state.hasWicho = localStorage.getItem('has_wicho') === 'true';
            state.infiniteQuestionsAnswered = parseInt(localStorage.getItem('infinite_answered') || 0, 10);
            checkDiscoBallLogic();
        }

        function checkDiscoBallLogic() {
            const allKnownIds = allAchievementsData.map(a => a.id);
            const allUnlocked = allKnownIds.every(id => state.achievements.some(a => a.id === id));
            if (allUnlocked) state.isDiscoBallVisible = true;
        }

        function unlockAchievement(id, title) {
            if (!state.achievements.some(a => a.id === id)) {
                state.achievements.push({ id, title });
                localStorage.setItem(`ach_${id}`, 'true');
                checkDiscoBallLogic();
                showToast(title);
                render(); // Re-renderizar para mostrar actualizaciones en tiempo real
            }
        }

        function showToast(title) {
            const container = document.getElementById('achievement-toast-container');
            const toast = document.createElement('div');
            toast.className = 'bg-yellow-800 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 animate-bounce-custom z-50';
            toast.innerHTML = `<i data-lucide="medal" width="16"></i> Â¡Logro: ${title.includes('?') ? 'Secreto Revelado' : title}!`;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.remove(), 4000);
        }

        // --- LÃ“GICA DEL JUEGO ---

        function handleKeyDown(e) {
            state.cheatBuffer = (state.cheatBuffer + e.key).slice(-6).toUpperCase();
            if (state.cheatBuffer === "PAPIUX" && !state.isAdmin) {
                state.isAdmin = true;
                alert("ðŸ‘‘ PAPIUX MODE ACTIVADO ðŸ‘‘");
                render();
            }
        }

        function startGame(mode) {
            state.isInfiniteMode = (mode === 'infinite');
            state.isExtremeMode = (mode === 'extreme');

            let finalQuestions = [];

            if (state.isInfiniteMode) {
                const infinitePool = questionsData.filter(q => q.difficulty >= 7);
                finalQuestions = [shuffleArray(infinitePool)[0]];
            } else {
                let filtered = questionsData.filter(q => q.difficulty <= 5);
                if (state.selectedCategory !== 'all') {
                    filtered = filtered.filter(q => q.category === state.selectedCategory);
                    if (filtered.length < 5) filtered = questionsData.filter(q => q.difficulty <= 5); // Fallback
                }

                const levels = [1, 2, 3, 4, 5].map(lvl => shuffleArray(filtered.filter(q => q.difficulty === lvl)));
                finalQuestions = levels.flat();
            }

            state.gameQuestions = finalQuestions;
            state.currentQIndex = 0;
            state.score = 0;
            state.lives = 3;
            state.streak = 0;
            state.lifelines = { fifty: true, skip: true };
            state.gameState = 'playing';
            resetQuestionState();
            render();
        }

        function resetQuestionState() {
            state.isAnswered = false;
            state.hiddenOptions = [];
            state.feedbackMsg = "";
            state.inputValue = "";
        }

        function nextQuestion() {
            if (state.isInfiniteMode) {
                const infinitePool = questionsData.filter(q => q.difficulty >= 7);
                const newQ = shuffleArray(infinitePool)[0];
                state.gameQuestions = [newQ];
                state.currentQIndex = 0;
            } else if (state.currentQIndex + 1 < state.gameQuestions.length) {
                state.currentQIndex++;
            } else {
                endGame(true);
                return;
            }
            resetQuestionState();
            render();
        }

        function endGame(win) {
            state.gameState = 'end';
            if (win && !state.isInfiniteMode) {
                state.isInfiniteModeUnlocked = true;
                localStorage.setItem('infinite_unlocked', 'true');
                state.hasWicho = true;
                localStorage.setItem('has_wicho', 'true');
                unlockAchievement('grand_master', 'Maestro Completado');
            }
            if (!win && state.isInfiniteMode) {
                state.feedbackMsg = "Â¡LÃ­mite alcanzado! Hemos agotado nuestra base de datos.";
            }
            render();
        }

        function checkAnswer(isCorrect, userAnswerText = "") {
            if (state.isAnswered) return;
            state.isAnswered = true;

            const currentQ = state.gameQuestions[state.currentQIndex];
            const multiplier = state.isExtremeMode ? 2 : 1;

            if (isCorrect) {
                state.feedbackMsg = "Â¡Correcto!";
                state.score += (currentQ.difficulty * 500 * multiplier);
                state.streak++;

                if (state.isInfiniteMode) {
                    state.infiniteQuestionsAnswered++;
                    localStorage.setItem('infinite_answered', state.infiniteQuestionsAnswered.toString());
                    if (state.infiniteQuestionsAnswered >= 5) unlockAchievement('secret_infinite', 'El Saber Oculto');
                }

                unlockAchievement('first_blood', 'Primeros Pasos');
                if (state.streak >= 3) unlockAchievement('streak_3', 'En Racha (3)');
                if (state.streak >= 5) unlockAchievement('streak_5', 'Imparable (5)');
                if (state.isExtremeMode && !state.isInfiniteMode) unlockAchievement('extreme', 'Valiente');

                if (!currentQ.explanation || state.isInfiniteMode) {
                    setTimeout(nextQuestion, 1500);
                }
            } else {
                state.feedbackMsg = `Incorrecto. La respuesta era: ${currentQ.options[currentQ.correct]}`;
                state.streak = 0;

                if (state.lives > 1 && !state.isInfiniteMode) {
                    state.lives--;
                    if (!currentQ.explanation) setTimeout(nextQuestion, 3000);
                } else {
                    state.lives = state.lives > 0 ? state.lives - 1 : 0; // Reduce visualmente a 0
                    if (!currentQ.explanation) setTimeout(() => endGame(false), 3000);
                }
            }
            render();
        }

        function handleTextSubmit(e) {
            e.preventDefault();
            const currentQ = state.gameQuestions[state.currentQIndex];
            const userText = normalizeText(state.inputValue);
            const correctText = normalizeText(currentQ.options[currentQ.correct]);
            const keywords = currentQ.keywords ? currentQ.keywords.map(k => normalizeText(k)) : [];

            const isMatch = userText === correctText || keywords.includes(userText);
            checkAnswer(isMatch);
        }

        function use5050() {
            if (!state.lifelines.fifty && !state.isAdmin) return;
            const currentQ = state.gameQuestions[state.currentQIndex];
            const wrongOptions = currentQ.options.map((_, i) => i).filter(i => i !== currentQ.correct);
            state.hiddenOptions = wrongOptions.sort(() => 0.5 - Math.random()).slice(0, 2);
            if (!state.isAdmin) state.lifelines.fifty = false;
            render();
        }

        function useSkip() {
            if (state.isAdmin) {
                checkAnswer(true);
            } else {
                if (!state.lifelines.skip && !state.isInfiniteMode) return;
                if (!state.isInfiniteMode) state.lifelines.skip = false;
                nextQuestion();
            }
        }

        // --- RENDERIZADO (VISTAS) ---

        function renderStart() {
            return `
                <div class="bg-slate-800 p-8 rounded-2xl max-w-lg w-full shadow-2xl border border-yellow-700/50 text-center relative overflow-hidden fade-in">
                    ${state.isDiscoBallVisible ? `<div class="absolute top-[-20px] left-1/2 transform -translate-x-1/2 z-10 animate-spin-slow"><i data-lucide="disc-3" size="48" class="text-blue-400 fill-blue-700"></i></div>` : ''}
                    ${state.hasWicho ? `<div class="absolute top-4 left-4 z-10 animate-bounce-custom" title="Â¡Miau!"><span class="absolute top-[-15px] left-[30px] bg-white text-slate-900 px-2 py-0.5 rounded-full text-xs font-bold shadow-md">Miau</span><div class="p-2 bg-yellow-900/50 rounded-full border border-yellow-600/50"><i data-lucide="cat" class="text-yellow-400"></i></div></div>` : ''}
                    ${state.isAdmin ? `<div class="absolute top-0 right-0 bg-red-500 text-black font-bold text-xs px-2 py-1 rotate-45 translate-x-4 translate-y-2 shadow-lg z-10">PAPIUX MODE</div>` : ''}

                    <div class="mb-6 flex justify-center">
                        <div class="p-4 rounded-full ${state.isAdmin ? 'bg-red-500 shadow-[0_0_20px_rgba(234,179,8,0.5)]' : 'bg-yellow-600 shadow-xl'}">
                            <i data-lucide="crown" size="48" class="text-black w-12 h-12"></i>
                        </div>
                    </div>

                    <h1 class="text-4xl font-extrabold mb-2 text-yellow-400 tracking-tight">EL GRAN RETO DEL MAESTRO</h1>
                    <p class="text-gray-400 mb-8 text-lg">Selecciona tu modo de juego y prepÃ¡rate.</p>

                    <div class="mb-8 space-y-4">
                        <div class="text-left bg-slate-900/50 p-4 rounded-lg border border-yellow-700/30">
                            <label class="block text-sm font-bold mb-2 text-yellow-400 uppercase">Tema (Modo Normal):</label>
                            <select onchange="state.selectedCategory = this.value" class="w-full bg-slate-800 border border-yellow-700/50 rounded p-3 text-white outline-none focus:border-yellow-500">
                                <option value="all">ðŸŽ² Todo Mezclado</option>
                                <option value="Historia">ðŸ“œ Historia</option>
                                <option value="Literatura">ðŸ“– Literatura</option>
                                <option value="TeologÃ­a">âœ¨ ReligiÃ³n/TeologÃ­a</option>
                                <option value="FilosofÃ­a">ðŸ§  FilosofÃ­a</option>
                            </select>
                        </div>
                        <button onclick="startGame('normal')" class="w-full text-black font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:scale-[1.02] bg-yellow-500 hover:bg-yellow-400 text-xl">Modo Normal</button>
                        <button onclick="startGame('extreme')" class="w-full text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:scale-[1.02] bg-red-700 hover:bg-red-600 text-xl">Modo Extremo (Escribir)</button>
                        ${state.isInfiniteModeUnlocked ? `<button onclick="startGame('infinite')" class="w-full flex items-center justify-center gap-2 text-black font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:scale-[1.02] bg-amber-400 hover:bg-amber-300 border-4 border-amber-600 animate-pulse text-xl"><i data-lucide="infinity"></i> MODO INFINITO</button>` : ''}
                    </div>

                    <div class="mb-8 p-4 bg-slate-900/50 rounded-lg border border-yellow-700/30 text-left">
                        <div class="flex items-center mb-3 text-yellow-400 gap-2 font-bold text-lg">
                            <i data-lucide="trophy" size="20"></i> SalÃ³n de la Fama
                        </div>
                        <div class="grid grid-cols-1 gap-2">
                            ${allAchievementsData.map(ach => {
                const unlocked = state.achievements.some(a => a.id === ach.id);
                return `<div class="flex items-center text-sm"><i data-lucide="medal" class="mr-2 w-4 h-4 ${unlocked ? 'text-yellow-400' : 'text-gray-700'}"></i> <span class="${unlocked ? 'text-white font-medium' : 'text-gray-500 line-through'}">${(ach.isSecret && !unlocked) ? "?? ?? ?" : ach.title}</span></div>`;
            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGame() {
            const currentQ = state.gameQuestions[state.currentQIndex];
            const progress = ((state.currentQIndex + 1) / state.gameQuestions.length) * 100;

            let inputSection = '';
            if (state.isExtremeMode || state.isInfiniteMode) {
                const borderClass = state.isAnswered ? (state.feedbackMsg.includes("Correcto") ? "border-green-500 text-green-400" : "border-red-500 text-red-400") : "border-yellow-700/50 focus:border-yellow-500";
                inputSection = `
                    <form onsubmit="handleTextSubmit(event)" class="mb-6">
                        <div class="relative">
                            <input type="text" value="${state.inputValue}" oninput="state.inputValue = this.value" ${state.isAnswered ? 'disabled' : ''} placeholder="Escribe tu respuesta..." class="w-full bg-slate-950 border-2 rounded-xl p-4 text-lg outline-none transition-colors ${borderClass}" autofocus>
                            <button type="submit" ${state.isAnswered || !state.inputValue.trim() ? 'disabled' : ''} class="absolute right-2 top-2 bottom-2 bg-yellow-600 text-black px-4 rounded-lg font-bold disabled:opacity-50">Enviar</button>
                        </div>
                    </form>
                    ${state.isAdmin && !state.isAnswered ? `<button onclick="checkAnswer(true)" class="flex mx-auto items-center gap-2 px-4 py-2 rounded-full font-bold text-xs bg-red-600 text-white animate-pulse mb-4"><i data-lucide="zap" size="12"></i> AUTO WIN</button>` : ''}
                `;
            } else {
                inputSection = `
                    <div class="grid grid-cols-1 gap-3 mb-6">
                        ${currentQ.options.map((opt, idx) => {
                    if (state.hiddenOptions.includes(idx)) return '<div class="invisible"></div>';
                    let btnClass = "p-4 rounded-xl text-left transition-all border-2 text-lg ";
                    if (state.isAnswered) {
                        btnClass += (idx === currentQ.correct) ? "bg-green-900/20 border-green-500 text-green-400" : "bg-slate-800 border-slate-800 text-gray-500 opacity-50";
                    } else {
                        btnClass += "bg-slate-800 border-yellow-700/50 hover:border-yellow-500 hover:bg-slate-750 text-slate-200";
                    }
                    return `<button onclick="checkAnswer(${idx === currentQ.correct})" ${state.isAnswered ? 'disabled' : ''} class="${btnClass}">${opt}</button>`;
                }).join('')}
                    </div>
                `;
            }

            const feedback = state.isAnswered ? `<div class="mt-2 p-3 rounded-lg text-center font-bold ${state.feedbackMsg.includes("Correcto") ? "bg-green-900/30 text-green-400" : "bg-red-900/30 text-red-400"}">${state.feedbackMsg}</div>` : '';

            const explanationSection = (state.isAnswered && currentQ.explanation && !state.isInfiniteMode) ? `
                <div class="mt-6 pt-4 border-t border-yellow-800 fade-in">
                    <div class="p-4 bg-slate-800 rounded-lg text-left mb-4 border border-yellow-500/50">
                        <h4 class="font-bold text-yellow-400 mb-2">ExplicaciÃ³n:</h4>
                        <p class="text-sm text-gray-300">${currentQ.explanation}</p>
                    </div>
                    <button onclick="${state.lives === 0 ? 'endGame(false)' : 'nextQuestion()'}" class="w-full font-bold py-3 rounded-xl transition ${state.lives === 0 ? 'bg-red-600 hover:bg-red-700' : 'bg-yellow-600 hover:bg-yellow-500 text-black'}">${state.lives === 0 ? 'Terminar Juego' : 'Continuar'}</button>
                </div>
            ` : '';

            const lifelinesSection = (!state.isExtremeMode && !state.isInfiniteMode && !state.isAnswered) ? `
                <div class="flex justify-center gap-4 pt-4 border-t border-yellow-800">
                    <button onclick="use5050()" ${(!state.lifelines.fifty && !state.isAdmin) ? 'disabled' : ''} class="flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all ${(!state.lifelines.fifty && !state.isAdmin) ? 'opacity-30' : 'bg-slate-800 hover:bg-slate-700 text-yellow-400 border border-yellow-900'}"><i data-lucide="zap" size="14"></i> 50/50</button>
                    <button onclick="useSkip()" ${(!state.lifelines.skip && !state.isAdmin) ? 'disabled' : ''} class="flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm transition-all ${state.isAdmin ? 'bg-red-600 text-white' : (!state.lifelines.skip) ? 'opacity-30' : 'bg-slate-800 hover:bg-slate-700 text-yellow-400 border border-yellow-900'}"><i data-lucide="skip-forward" size="14"></i> ${state.isAdmin ? "AUTO WIN" : "SALTAR"}</button>
                </div>
            ` : '';

            return `
                <div class="w-full max-w-2xl mb-8 flex items-center gap-2 fade-in">
                    <div class="flex-1 bg-slate-900 p-4 rounded-xl border border-yellow-800 flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2"><i data-lucide="star" class="text-yellow-500" size="20"></i> <span class="font-bold text-xl">${state.score}</span></div>
                            <div class="flex gap-1">${[0, 1, 2].map(i => `<i data-lucide="heart" size="20" class="${i < state.lives ? 'text-red-500 fill-red-500' : 'text-gray-700'}"></i>`).join('')}</div>
                            ${state.isAdmin ? '<i data-lucide="crown" size="20" class="text-yellow-400 animate-pulse"></i>' : ''}
                        </div>
                        <div class="px-3 py-1 rounded text-xs font-bold uppercase ${state.isInfiniteMode ? 'bg-amber-700 text-amber-200' : state.isExtremeMode ? 'bg-red-900 text-red-200' : 'bg-yellow-800 text-yellow-400'}">${state.isInfiniteMode ? 'MODO INFINITO' : state.isExtremeMode ? 'MODO EXTREMO' : `Nivel ${currentQ.difficulty}`}</div>
                    </div>
                    <button onclick="state.gameState='start'; render();" class="bg-slate-800 p-4 rounded-xl border border-yellow-700/50 hover:bg-red-900/50 hover:border-red-500 hover:text-red-400 transition-colors"><i data-lucide="log-out" size="24"></i></button>
                </div>

                <div class="w-full max-w-2xl bg-slate-900 rounded-2xl p-6 md:p-10 shadow-xl border border-yellow-800 relative overflow-hidden fade-in">
                    ${!state.isInfiniteMode ? `<div class="absolute top-0 left-0 h-1 bg-yellow-500 transition-all duration-500" style="width: ${progress}%"></div>` : ''}
                    <span class="text-yellow-400 font-bold text-xs tracking-widest uppercase mb-4 block">${currentQ.category}</span>
                    <h2 class="text-2xl md:text-3xl font-bold mb-8 text-white leading-snug">${currentQ.q}</h2>
                    
                    ${inputSection}
                    ${feedback}
                    ${explanationSection}
                    ${lifelinesSection}

                    ${state.isInfiniteMode ? `<div class="flex justify-center pt-4 mt-4 border-t border-yellow-800"><div class="px-4 py-2 rounded-full bg-amber-900/50 text-amber-300 font-bold text-sm flex items-center gap-2"><i data-lucide="infinity" size="16"></i> Respuestas: ${state.infiniteQuestionsAnswered}</div></div>` : ''}
                </div>
            `;
        }

        function renderEnd() {
            return `
                <div class="bg-gradient-to-br from-yellow-300 via-amber-400 to-yellow-600 p-1.5 rounded-3xl max-w-lg w-full animate-shimmer fade-in">
                    <div class="bg-slate-900 rounded-3xl p-8 text-center border-4 border-amber-800">
                        <div class="mx-auto text-yellow-400 mb-6 animate-pulse flex justify-center"><i data-lucide="aperture" width="80" height="80"></i></div>
                        <h2 class="text-4xl font-extrabold text-yellow-400 mb-2 uppercase tracking-wide">${state.isInfiniteMode && !state.feedbackMsg.includes("agotado") ? "Â¡MODO INFINITO!" : "Â¡RETO FINALIZADO!"}</h2>
                        <p class="text-lg text-amber-200 mb-6 font-medium">${state.feedbackMsg.includes("agotado") ? state.feedbackMsg : "Has demostrado ser un verdadero Maestro."}</p>
                        <div class="text-7xl font-black text-yellow-300 mb-4 bg-clip-text text-transparent bg-gradient-to-r from-yellow-200 to-amber-500">${state.score} pts</div>
                        
                        ${state.hasWicho ? `<div class="mb-6 relative"><div class="relative bg-yellow-900/50 p-3 mx-auto rounded-xl flex items-center justify-center border border-yellow-600 shadow-inner"><i data-lucide="cat" size="48" class="text-yellow-300 w-12 h-12"></i><span class="ml-4 text-yellow-200 font-bold">WICHO DESBLOQUEADO</span></div></div>` : ''}

                        <button onclick="state.gameState='start'; render();" class="w-full bg-yellow-500 text-black font-bold py-3 rounded-xl hover:bg-yellow-400 transition shadow-yellow-500/50 mt-4">Volver al SalÃ³n Principal</button>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            let content = '';
            if (state.gameState === 'start') content = renderStart();
            else if (state.gameState === 'playing') content = renderGame();
            else if (state.gameState === 'end') content = renderEnd();
            app.innerHTML = content;
            lucide.createIcons(); // Reactiva los iconos
        }

        // --- INICIALIZACIÃ“N ---
        window.onload = function () {
            loadProgression();
            window.addEventListener('keydown', handleKeyDown);
            render();
        };

    </script>
</body>

</html>
