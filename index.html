<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God's Plan | Portal Corporativo</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuentes e Iconos -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: '#E70000', 
                        brandDark: '#8a0000',
                        dark: '#050505',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #000; 
            color: white; 
            overflow-x: hidden;
        } 

        /* Scrollbar Personalizado */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #E70000; }

        /* Fondo Grid Tecnológico */
        .bg-tech {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 10% 10%, #150000 0%, #000 80%);
        }
        .grid-overlay {
            position: absolute; inset: 0;
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            pointer-events: none;
        }

        /* Glass Cards */
        .glass-panel {
            background: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Sticky Login Container */
        .sticky-container {
            /* Fixes the sticky element height issue on mobile when not needed */
            position: static; 
            height: auto;
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .sticky-container {
                position: sticky;
                top: 100px; 
                height: fit-content;
            }
        }


        /* Animaciones de Scroll */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Inputs */
        .input-modern {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            transition: all 0.3s;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
        }
        .input-modern:focus {
            border-color: #E70000;
            background: rgba(231,0,0,0.05);
            outline: none;
            box-shadow: 0 0 0 2px rgba(231,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased">

    <div class="bg-tech">
        <div class="grid-overlay"></div>
    </div>

    <!-- HEADER -->
    <header class="h-20 border-b border-white/5 backdrop-blur-md fixed top-0 w-full z-50 flex items-center justify-between px-6 lg:px-12 bg-black/50">
        <div class="flex items-center gap-10">
            <a href="/" class="flex items-center gap-3 font-bold tracking-widest text-white group decoration-0">
                <div class="w-8 h-8 rounded bg-brand flex items-center justify-center text-white shadow-lg shadow-brand/20">
                    <i class="ph-bold ph-circles-three-plus text-xl"></i>
                </div>
                <span class="text-sm md:text-base">GOD'S PLAN</span>
            </a>
            <!-- Links Desktop (Restaurados) -->
            <nav class="hidden md:flex items-center gap-8">
                <a href="/adherencia.html" class="nav-item text-xs font-bold text-zinc-400 hover:text-white transition-colors">ADHERENCIA</a>
                <a href="/chat.html" class="nav-item text-xs font-bold text-zinc-400 hover:text-white transition-colors">CHAT</a>
                <a href="/finanzas.html" class="nav-item text-xs font-bold text-zinc-400 hover:text-white transition-colors">FINANZAS</a>
            </nav>
        </div>
        
        <!-- User Status (Visible on Header) -->
        <div id="user-display-mini" class="hidden flex items-center gap-3">
            <span id="header-user-name" class="text-xs font-mono text-zinc-400 hidden sm:block">Usuario</span>
            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse" title="Online"></div>
            <button id="logout-button-mini" class="text-zinc-500 hover:text-white transition-colors" title="Cerrar Sesión">
                <i class="ph-bold ph-sign-out text-lg"></i>
            </button>
        </div>
    </header>

    <!-- MAIN LAYOUT -->
    <main class="relative w-full max-w-7xl mx-auto px-6 grid lg:grid-cols-12 gap-12 pt-32 pb-20">
        
        <!-- COLUMNA IZQUIERDA (SCROLLABLE CONTENT) -->
        <div class="lg:col-span-7 flex flex-col gap-32 order-2 lg:order-1"> <!-- order-2 para que vaya después del login en móvil -->
            
            <!-- SECCIÓN 1: HERO -->
            <section class="reveal active relative pt-10">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-brand/30 bg-brand/5 text-brand text-[10px] font-bold tracking-widest mb-6">
                    <span class="w-1.5 h-1.5 rounded-full bg-brand animate-ping"></span>
                    ECOSISTEMA CENTRALIZADO v2.5
                </div>
                <h1 class="text-6xl md:text-8xl font-black tracking-tighter text-white mb-6 leading-[0.9]">
                    TU <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-brand to-red-600">HUB DIGITAL</span>
                </h1>
                <p class="text-zinc-400 text-lg md:text-xl max-w-lg leading-relaxed border-l-4 border-brand/50 pl-6">
                    La plataforma unificada para administrar tus procesos clave: finanzas, operaciones y comunicación segura.
                </p>
                
                <!-- Estado Simple del Sistema -->
                <div class="mt-12">
                    <p class="text-xs text-zinc-500 font-mono uppercase tracking-widest">Estado del Sistema</p>
                    <div class="flex items-center gap-4 mt-2">
                        <div class="text-4xl font-bold text-white" id="hero-efficiency">100%</div>
                        <span class="text-green-500 font-semibold">| Todos los módulos operativos.</span>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 2: COMPONENTES CLAVE -->
            <section class="reveal space-y-8">
                <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-3">
                    <i class="ph-fill ph-check-square text-brand"></i>
                    Componentes Clave
                </h2>
                
                <!-- Feature Card 1: Finanzas -->
                <div class="glass-panel p-8 rounded-2xl hover:border-brand/30 transition-colors group cursor-default">
                    <div class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand/10 transition-colors">
                        <i class="ph-bold ph-currency-circle-dollar text-2xl text-zinc-400 group-hover:text-brand"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Inteligencia Financiera</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">
                        Control total sobre la gestión de nómina, gastos operativos y análisis de flujo de caja en tiempo real.
                    </p>
                </div>

                <!-- Feature Card 2: Seguridad -->
                <div class="glass-panel p-8 rounded-2xl hover:border-brand/30 transition-colors group cursor-default">
                    <div class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand/10 transition-colors">
                        <i class="ph-bold ph-shield-star text-2xl text-zinc-400 group-hover:text-brand"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Seguridad Proactiva</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">
                        Protección de datos y comunicaciones mediante protocolos de encriptación avanzados y gestión de accesos.
                    </p>
                </div>

                <!-- Feature Card 3: Adherencia/Tiempos -->
                <div class="glass-panel p-8 rounded-2xl hover:border-brand/30 transition-colors group cursor-default">
                    <div class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand/10 transition-colors">
                        <i class="ph-bold ph-clock text-2xl text-zinc-400 group-hover:text-brand"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Gestión de Tiempos</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">
                        Control de asistencia, horarios y adhesión a la jornada laboral de manera precisa y centralizada.
                    </p>
                </div>

                <!-- Feature Card 4: Perfil/Cuenta -->
                <div class="glass-panel p-8 rounded-2xl hover:border-brand/30 transition-colors group cursor-default">
                    <div class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand/10 transition-colors">
                        <i class="ph-bold ph-user-gear text-2xl text-zinc-400 group-hover:text-brand"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Administración de Perfil</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">
                        Accede y administra tus datos personales, permisos de usuario y configuración de notificaciones.
                    </p>
                </div>

            </section>

            <!-- SECCIÓN 3: ESPACIO VACÍO (Placeholder para futuro contenido) -->
            <section class="reveal glass-panel p-8 rounded-3xl h-64 flex items-center justify-center border-dashed border-zinc-800">
                <p class="text-zinc-600 font-mono text-sm">
                    // ESPACIO DISPONIBLE PARA WIDGETS O CONTENIDO ADICIONAL //
                </p>
            </section>

             <footer class="text-zinc-700 text-xs font-mono pt-20 pb-10">
                // Compromiso con la excelencia operativa. © 2025 God's Plan.
            </footer>
        </div>

        <!-- COLUMNA DERECHA (STICKY LOGIN) -->
        <div class="lg:col-span-5 relative order-1 lg:order-2"> <!-- order-1 para que vaya antes del contenido en móvil -->
            <div class="sticky-container w-full">
                
                <!-- CARD LOGIN / REGISTER -->
                <div id="auth-panel" class="glass-panel rounded-3xl p-8 shadow-2xl shadow-black/50 transition-all duration-500">
                    <div class="text-center mb-8">
                        <h2 id="auth-title" class="text-2xl font-bold text-white">Bienvenido(a)</h2>
                        <p id="auth-subtitle" class="text-zinc-400 text-sm mt-2">Ingresa tus credenciales para continuar.</p>
                    </div>

                    <form id="auth-form" onsubmit="event.preventDefault(); window.authLogic.processEmailAuth();">
                         <div id="name-field" class="mb-4 hidden fade-in">
                            <label class="block text-xs font-bold text-zinc-500 uppercase mb-2">Nombre Completo</label>
                            <input type="text" id="reg-name" class="input-modern w-full" placeholder="Nombre Apellido">
                        </div>

                        <div class="mb-4">
                            <label class="block text-xs font-bold text-zinc-500 uppercase mb-2">Identificación de Usuario</label>
                            <input type="text" id="email" class="input-modern w-full" placeholder="ID o Email corporativo">
                        </div>

                        <div class="mb-6">
                            <label class="block text-xs font-bold text-zinc-500 uppercase mb-2">Contraseña</label>
                            <input type="password" id="password" class="input-modern w-full" placeholder="••••••••">
                        </div>

                        <div id="error-message" class="text-xs text-red-400 bg-red-500/10 p-3 rounded-lg mb-4 hidden border border-red-500/20 text-center font-mono">
                            > Error: Credenciales inválidas. Por favor, verifica.
                        </div>

                        <button type="submit" id="submit-btn" class="w-full bg-brand hover:bg-red-600 text-white font-bold py-3.5 rounded-xl transition-all shadow-[0_0_20px_rgba(231,0,0,0.3)] hover:shadow-[0_0_30px_rgba(231,0,0,0.5)] flex items-center justify-center gap-2 group">
                            <span class="group-hover:translate-x-1 transition-transform">ACCEDER AL SISTEMA</span>
                        </button>
                    </form>

                    <div class="mt-6 space-y-3">
                         <div class="grid grid-cols-2 gap-3">
                            <button onclick="window.authLogic.loginGoogle()" class="bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl py-2.5 flex items-center justify-center transition-colors">
                                <i class="ph-bold ph-google-logo text-lg text-white"></i>
                            </button>
                            <button onclick="window.authLogic.loginGuest()" class="bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl py-2.5 flex items-center justify-center transition-colors group text-zinc-400 hover:text-white" title="Acceso de Invitado">
                                <i class="ph-bold ph-user text-lg"></i>
                            </button>
                        </div>
                        
                        <div class="text-center pt-2">
                            <button onclick="window.authLogic.toggleMode()" class="text-xs text-zinc-500 hover:text-white transition-colors">
                                <span id="toggle-text">¿No tienes cuenta? Regístrate aquí</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- DASHBOARD RÁPIDO (Se muestra al loguear, reemplaza al login) -->
                <div id="dashboard-panel" class="glass-panel rounded-3xl p-8 shadow-2xl shadow-black/50 hidden animate-float">
                    <div class="flex items-center gap-4 mb-8 border-b border-white/5 pb-6">
                        <div class="w-16 h-16 rounded-full bg-brand flex items-center justify-center text-white text-2xl font-bold shadow-lg shadow-brand/40">
                            <span id="user-initial">U</span>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-white leading-tight">Bienvenido(a), <br><span id="user-name-large" class="text-brand">Usuario</span></h2>
                            <p class="text-xs text-zinc-400 mt-1">Acceso Principal</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 gap-3">
                        <a href="/adherencia.html" class="flex items-center gap-4 p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-brand/50 transition-all group">
                            <div class="w-10 h-10 rounded-lg bg-zinc-900 flex items-center justify-center text-zinc-400 group-hover:text-brand transition-colors">
                                <i class="ph-duotone ph-clock text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-white">Gestión de Tiempos</h4>
                                <p class="text-[10px] text-zinc-500">Control de asistencia y horario</p>
                            </div>
                            <i class="ph-bold ph-caret-right ml-auto text-zinc-600 group-hover:text-white"></i>
                        </a>

                        <a href="/chat.html" class="flex items-center gap-4 p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-brand/50 transition-all group">
                             <div class="w-10 h-10 rounded-lg bg-zinc-900 flex items-center justify-center text-zinc-400 group-hover:text-brand transition-colors">
                                <i class="ph-duotone ph-chat-centered-text text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-white">Comunicación Interna</h4>
                                <p class="text-[10px] text-zinc-500">Mensajería encriptada</p>
                            </div>
                            <i class="ph-bold ph-caret-right ml-auto text-zinc-600 group-hover:text-white"></i>
                        </a>

                        <a href="/finanzas.html" class="flex items-center gap-4 p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-brand/50 transition-all group">
                             <div class="w-10 h-10 rounded-lg bg-zinc-900 flex items-center justify-center text-zinc-400 group-hover:text-brand transition-colors">
                                <i class="ph-duotone ph-currency-dollar text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-white">Finanzas & Nómina</h4>
                                <p class="text-[10px] text-zinc-500">Acceso a documentos y reportes</p>
                            </div>
                            <i class="ph-bold ph-caret-right ml-auto text-zinc-600 group-hover:text-white"></i>
                        </a>
                        
                         <a href="/cuenta.html" class="flex items-center gap-4 p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-brand/50 transition-all group">
                             <div class="w-10 h-10 rounded-lg bg-zinc-900 flex items-center justify-center text-zinc-400 group-hover:text-brand transition-colors">
                                <i class="ph-duotone ph-user-gear text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-white">Mi Perfil</h4>
                                <p class="text-[10px] text-zinc-500">Configuración y ajustes de cuenta</p>
                            </div>
                            <i class="ph-bold ph-caret-right ml-auto text-zinc-600 group-hover:text-white"></i>
                        </a>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, signInWithCustomToken, signInAnonymously, signOut, 
            setPersistence, browserLocalPersistence 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Scroll Animation Logic
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

        // Firebase Config
        const fallbackConfig = { apiKey: "AIzaSyCrHBz94UtgiaYntHCYhC5jNa6auUI63vQ", authDomain: "god-s-plan-d737b.firebaseapp.com", projectId: "god-s-plan-d737b", storageBucket: "god-s-plan-d737b.firebasestorage.app", messagingSenderId: "458198314028", appId: "1:458198314028:web:d62b24cee2d19ee5b47589" };
        let firebaseConfig = fallbackConfig;
        try { 
            if (typeof __firebase_config !== 'undefined' && __firebase_config) { 
                const envConfig = typeof __firebase_config === 'string' ? JSON.parse(__firebase_config) : __firebase_config; 
                if (envConfig && envConfig.apiKey) firebaseConfig = envConfig; 
            } 
        } catch(e) {}

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // ** CORRECCIÓN: Persistencia de Sesión **
        // Aseguramos que se configure la persistencia de la sesión.
        setPersistence(auth, browserLocalPersistence).catch(console.error);

        // UI Refs
        const els = {
            authPanel: document.getElementById('auth-panel'),
            dashPanel: document.getElementById('dashboard-panel'),
            authTitle: document.getElementById('auth-title'),
            authSub: document.getElementById('auth-subtitle'),
            submitBtn: document.getElementById('submit-btn'),
            toggleTxt: document.getElementById('toggle-text'),
            nameField: document.getElementById('name-field'),
            errorMsg: document.getElementById('error-message'),
            miniUserDisplay: document.getElementById('user-display-mini'),
            headerUserName: document.getElementById('header-user-name'),
            largeUserName: document.getElementById('user-name-large'),
            userInitial: document.getElementById('user-initial'),
            // Metrics (Se mantienen las referencias, aunque ya no se usen en el HTML)
            heroEff: document.getElementById('hero-efficiency'),
            heroMods: document.getElementById('hero-modules')
        };

        // Auth Logic
        window.authLogic = {
            mode: 'login',
            toggleMode: function() {
                this.mode = this.mode === 'login' ? 'register' : 'login';
                const isReg = this.mode === 'register';
                els.authTitle.textContent = isReg ? 'Crear Cuenta' : 'Bienvenido(a)';
                els.authSub.textContent = isReg ? 'Completa tus datos para crear una cuenta' : 'Ingresa tus credenciales para continuar.';
                els.submitBtn.innerHTML = isReg ? '<span>REGISTRAR CUENTA</span>' : '<span>ACCEDER AL SISTEMA</span>';
                els.toggleTxt.textContent = isReg ? '¿Ya tienes cuenta? Inicia sesión' : '¿No tienes cuenta? Regístrate aquí';
                els.nameField.classList.toggle('hidden', !isReg);
                els.errorMsg.classList.add('hidden');
            },
            showError: function(msg) {
                els.errorMsg.textContent = "> Error: " + msg;
                els.errorMsg.classList.remove('hidden');
                els.submitBtn.disabled = false;
                els.submitBtn.classList.remove('opacity-50');
            },
            processEmailAuth: async function() {
                els.submitBtn.disabled = true;
                els.submitBtn.classList.add('opacity-50');
                els.errorMsg.classList.add('hidden');

                let email = document.getElementById('email').value.trim();
                const pass = document.getElementById('password').value;
                if (!email.includes('@')) email = `${email}@godsplan.site`;

                try {
                    // La persistencia ya está configurada arriba
                    await signInWithEmailAndPassword(auth, email, pass);
                } catch (e) {
                    let msg = "Error de conexión. Inténtalo de nuevo.";
                    if(e.code.includes('invalid') || e.code.includes('found')) msg = "Credenciales inválidas. Por favor, verifica.";
                    this.showError(msg);
                }
            },
            loginGoogle: async () => { try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch(e){ els.errorMsg.textContent=e.message; els.errorMsg.classList.remove('hidden'); } },
            loginGuest: async () => { try { await signInAnonymously(auth); } catch(e){ els.errorMsg.textContent=e.message; els.errorMsg.classList.remove('hidden'); } },
            logout: async () => { await signOut(auth); window.location.reload(); }
        };

        document.getElementById('logout-button-mini').onclick = window.authLogic.logout;

        // Init System
        async function init() {
            // Metrics (Se mantiene la conexión a Firebase Firestore)
            if(!auth.currentUser) try { await signInAnonymously(auth); } catch(e){}
            const metricsRef = doc(db, 'artifacts', appId, 'public', 'data', 'system_metrics', 'dashboard_stats');
            onSnapshot(metricsRef, (s) => {
                const d = s.exists() ? s.data() : { efficiency: 98, modules: [1,2,3,4] };
                // Lógica de métricas futura
            });

            // Auth State
            const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
            if(token) try { await signInWithCustomToken(auth, token); } catch(e){}

            onAuthStateChanged(auth, (user) => {
                if(user && !user.isAnonymous) {
                    const name = user.displayName || user.email.split('@')[0];
                    els.headerUserName.textContent = name;
                    els.largeUserName.textContent = name.split(' ')[0];
                    els.userInitial.textContent = name.charAt(0).toUpperCase();
                    
                    els.miniUserDisplay.classList.remove('hidden');
                    els.authPanel.classList.add('hidden');
                    els.dashPanel.classList.remove('hidden');
                } else {
                    els.miniUserDisplay.classList.add('hidden');
                    els.authPanel.classList.remove('hidden');
                    els.dashPanel.classList.add('hidden');
                }
            });
        }
        init();
    </script>
</body>
</html>
