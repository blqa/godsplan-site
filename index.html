<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God's Plan | Portal de Acceso</title>
    
    <!-- LIBRERIAS (Tailwind + Fuentes + Iconos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: '#E70000', 
                        dark: '#050505',
                        card: '#121212'
                    },
                    animation: {
                        'float': 'float 10s infinite ease-in-out',
                        'fade-in': 'fadeIn 0.5s ease-out'
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translate(0, 0)' }, '50%': { transform: 'translate(20px, -20px)' } },
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: white; overflow-x: hidden; }
        
        /* Fondo Animado */
        .bg-orb {
            position: fixed; width: 100vmax; height: 100vmax;
            background: radial-gradient(circle, rgba(231, 0, 0, 0.1) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: -1;
            animation: float 15s infinite ease-in-out;
        }

        /* Input Estilizado */
        .input-god {
            background: rgba(255,255,255,0.03); border: 1px solid #333; color: white;
            transition: all 0.3s; width: 100%; padding: 12px 16px; border-radius: 12px;
            font-size: 1rem;
        }
        .input-god:focus { border-color: #E70000; outline: none; box-shadow: 0 0 0 2px rgba(231,0,0,0.1); background: rgba(231,0,0,0.05); }

        /* Tarjetas del Portal */
        .portal-card {
            background: rgba(20,20,20,0.6); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.05); border-radius: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer; position: relative; overflow: hidden;
        }
        .portal-card:hover {
            transform: translateY(-5px); border-color: rgba(231,0,0,0.3);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }
        /* Efecto Glow Mouse */
        .portal-card::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(800px circle at var(--mouse-x) var(--mouse-y), rgba(255,255,255,0.06), transparent 40%);
            opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
        .portal-card:hover::before { opacity: 1; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 relative">

    <!-- ELEMENTOS DE FONDO -->
    <div class="bg-orb" style="top: -50%; left: -20%;"></div>
    <div class="bg-orb" style="bottom: -50%; right: -20%; animation-delay: -5s;"></div>

    <!-- CONTENEDOR PRINCIPAL -->
    <main class="w-full max-w-5xl relative z-10">

        <!-- HEADER SIMPLE -->
        <header class="absolute top-0 left-0 w-full flex justify-between items-center p-4 md:p-0 md:-top-24">
            <div class="flex items-center gap-2 font-black tracking-wider text-xl">
                <i class="ph-fill ph-circles-three-plus text-brand"></i> GOD'S PLAN
            </div>
            <div id="user-badge" class="hidden items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/10">
                <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                <span id="user-display" class="text-xs font-bold text-gray-300 uppercase">...</span>
                <button onclick="window.app.logout()" class="text-zinc-500 hover:text-white ml-2"><i class="ph-bold ph-sign-out"></i></button>
            </div>
        </header>

        <!-- VISTA 1: LOGIN (Se muestra si no hay sesión) -->
        <div id="view-login" class="max-w-md mx-auto animate-fade-in hidden">
            <div class="text-center mb-10">
                <h1 class="text-5xl font-black mb-4 tracking-tighter">IDENTIFÍCATE</h1>
                <p class="text-gray-400">Acceso restringido al ecosistema CorpoDatos & BLQA.</p>
            </div>

            <div class="bg-card/50 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl">
                <form onsubmit="event.preventDefault(); window.app.login();">
                    <div class="mb-4">
                        <label class="text-[10px] font-bold text-brand uppercase tracking-widest mb-2 block">ID de Agente / Acceso</label>
                        <input type="text" id="login-id" class="input-god text-center text-xl font-bold tracking-widest" placeholder="Ej: 17620" autofocus>
                    </div>
                    <div class="mb-8">
                        <label class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2 block">Contraseña</label>
                        <input type="password" id="login-pass" class="input-god text-center" placeholder="••••••••">
                    </div>
                    
                    <div id="error-msg" class="hidden mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-xs font-bold text-center">
                        Error de credenciales
                    </div>

                    <button type="submit" id="btn-login" class="w-full bg-brand hover:bg-red-600 text-white font-black py-4 rounded-xl transition-all shadow-[0_0_20px_rgba(231,0,0,0.3)] hover:shadow-[0_0_30px_rgba(231,0,0,0.5)] active:scale-95 uppercase tracking-wider text-sm flex items-center justify-center gap-2">
                        <span>Iniciar Sesión</span>
                        <i class="ph-bold ph-arrow-right"></i>
                    </button>
                </form>
            </div>
            <p class="text-center text-zinc-600 text-[10px] mt-6 font-mono">SECURE AUTHENTICATION v2.0</p>
        </div>

        <!-- VISTA 2: DASHBOARD (Se muestra si hay sesión) -->
        <div id="view-dashboard" class="hidden animate-fade-in w-full">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-5xl font-black mb-2 tracking-tight">SELECCIONA MÓDULO</h2>
                <p class="text-gray-400">Bienvenido al núcleo operativo.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 w-full max-w-4xl mx-auto">
                
                <!-- TARJETA 1: BLQA (Personal) -->
                <div class="portal-card group h-64 flex flex-col items-center justify-center p-8 text-center" onclick="window.location.href='/blqa/'">
                    <div class="w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6 group-hover:scale-110 transition-transform border border-white/10 group-hover:border-white/30">
                        <i class="ph-fill ph-alien text-4xl text-gray-300 group-hover:text-white"></i>
                    </div>
                    <h3 class="text-2xl font-black text-white mb-2 tracking-wide group-hover:text-brand transition-colors">BLQA CORE</h3>
                    <p class="text-sm text-gray-500 group-hover:text-gray-300">Identidad Digital, Portfolio & Legacy.</p>
                </div>

                <!-- TARJETA 2: CORPODATOS (Trabajo) -->
                <!-- Nota: Redirige a /corpo/adherencia.html que es tu "home" de herramientas actual -->
                <div class="portal-card group h-64 flex flex-col items-center justify-center p-8 text-center relative" onclick="window.location.href='/corpo/adherencia.html'">
                    <!-- Badge de Notificación -->
                    <div class="absolute top-6 right-6 flex gap-1">
                        <span class="w-2 h-2 rounded-full bg-brand animate-pulse"></span>
                    </div>

                    <div class="w-20 h-20 rounded-full bg-brand/10 flex items-center justify-center mb-6 group-hover:scale-110 transition-transform border border-brand/20 group-hover:border-brand">
                        <i class="ph-fill ph-buildings text-4xl text-brand"></i>
                    </div>
                    <h3 class="text-2xl font-black text-white mb-2 tracking-wide group-hover:text-brand transition-colors">CORPODATOS</h3>
                    <p class="text-sm text-gray-500 group-hover:text-gray-300">Adherencia, Finanzas, Chat & Casos.</p>
                </div>

            </div>
        </div>

    </main>

    <!-- LOGICA FIREBASE MODULAR -->
    <script type="module">
        // Importamos desde CDN para que funcione en GitHub Pages sin build
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // ==========================================
        // ✅ TUS CREDENCIALES OFICIALES (GODSPLAN-BLQA)
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyD0lX3XmVPQHNNxpsZS82YzDMzM6MLhq3g",
            authDomain: "godsplan-blqa.firebaseapp.com",
            projectId: "godsplan-blqa",
            storageBucket: "godsplan-blqa.firebasestorage.app",
            messagingSenderId: "1008783768310",
            appId: "1:1008783768310:web:c09fe541a2f4d23e5b8ad7"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Persistencia Local (Mantiene la sesión entre pestañas)
        setPersistence(auth, browserLocalPersistence).catch(console.error);

        window.app = {
            user: null,

            init() {
                // Escuchar cambios de sesión
                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    this.render();
                });

                // Efecto visual para las tarjetas (Glow del mouse)
                document.querySelectorAll('.portal-card').forEach(card => {
                    card.onmousemove = e => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        card.style.setProperty('--mouse-x', `${x}px`);
                        card.style.setProperty('--mouse-y', `${y}px`);
                    }
                });
            },

            render() {
                const loginView = document.getElementById('view-login');
                const dashView = document.getElementById('view-dashboard');
                const badge = document.getElementById('user-badge');

                if (this.user) {
                    // SI HAY SESIÓN -> DASHBOARD
                    loginView.classList.add('hidden');
                    dashView.classList.remove('hidden');
                    badge.classList.remove('hidden');
                    badge.classList.add('flex');
                    document.getElementById('user-display').textContent = this.user.email.split('@')[0];
                } else {
                    // NO HAY SESIÓN -> LOGIN
                    loginView.classList.remove('hidden');
                    dashView.classList.add('hidden');
                    badge.classList.add('hidden');
                    badge.classList.remove('flex');
                }
            },

            async login() {
                const btn = document.getElementById('btn-login');
                const errMsg = document.getElementById('error-msg');
                let id = document.getElementById('login-id').value.trim();
                const pass = document.getElementById('login-pass').value;

                if (!id || !pass) return;

                // --- MAGIA: CONVERTIR ID A EMAIL ---
                // Si el usuario escribe solo "17620", lo convertimos
                if (!id.includes('@')) {
                    id = `${id}@godsplan.site`;
                }

                btn.disabled = true;
                btn.innerHTML = '<i class="ph-bold ph-spinner animate-spin"></i> VERIFICANDO...';
                errMsg.classList.add('hidden');

                try {
                    await signInWithEmailAndPassword(auth, id, pass);
                    // El onAuthStateChanged se encargará de cambiar la vista automáticamente
                } catch (error) {
                    console.error(error);
                    errMsg.classList.remove('hidden');
                    errMsg.textContent = this.mapError(error.code);
                    btn.disabled = false;
                    btn.innerHTML = '<span>Intentar de Nuevo</span> <i class="ph-bold ph-arrow-right"></i>';
                }
            },

            logout() {
                signOut(auth);
            },

            mapError(code) {
                if (code === 'auth/user-not-found' || code === 'auth/wrong-password' || code === 'auth/invalid-credential') 
                    return "Credenciales incorrectas";
                if (code === 'auth/too-many-requests') return "Demasiados intentos. Espera un momento.";
                return "Error de acceso: " + code;
            }
        };

        // Arrancar
        window.app.init();
    </script>
</body>
</html>
